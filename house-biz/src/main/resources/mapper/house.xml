<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.jeelearn.house.biz.mapper.HouseMapper">
    <sql id="houseField">
     a.id,a.type,a.name,a.price,a.images,a.area,a.beds,a.baths,a.rating,a.remarks,a.properties,
     a.floor_plan,a.tags,a.create_time,a.city_id,a.community_id,a.address,a.state
    </sql>
    <sql id="houseCondition">
      <where>
          <if test="house.id !=null and house.id !=0">
              and a.id = #{house.id}
          </if>
          <if test="house.type != null">
              and a.type = #{house.type}
          </if>
          <if test="house.communityId != null" >
              and a.community_id = #{house.communityId}
          </if>
          <if test="house.name != null and house.name != '' " >
              <bind name="pattern1" value="'%' + house.name + '%'"/>
              and a.NAME  LIKE #{pattern1}
          </if>
          <if test="house.ids != null and house.ids.size() > 0">
              and a.id IN
              <foreach collection="house.ids" item="iteem" index="index"
                       open="(" close=")" separator=",">
                  #{item}
              </foreach>

          </if>
      </where>
    </sql>

    <select id="selectPageHouses" resultType="house">
      SELECT <include refid="houseField"/>
      FROM house a
      <include refid="houseCondition"/>
       <choose>
           <when test="house.sort != null and house.sort == 'price_asc'">
               order by a.price asc
           </when>
           <when test="house.sort != null and house.sort == 'price_desc'">
               order by a.price desc
           </when>
           <otherwise>
               ORDER BY a.create_time DESC
           </otherwise>
       </choose> 
       <if test="pageParams.offset != null and pageParams.limit != null">
          limit #{pageParams.offset},#{pageParams.limit}
      </if>
      <if test="pageParams.offset == null and pageParams.limit != null">
          limit #{pageParams.limit}
      </if>

    </select>

    <select id="selectPageCount" resultType="long">
      SELECT count(id)
      FROM house a
      <include refid="houseCondition"/>
    </select>

    <select id="selectCommunity" resultType="community">
      SELECT *
      FROM community
      <where>
          <if test="id != null and id != 0">
              AND id = #{id}
          </if>
          <if test="name != null and name != ''">
              and name = #{name}
          </if>
      </where>
    </select>

    <select id="selectSaleHouseUser" resultType="houseuser">
        SELECT id,house_id,user_id,create_time,type
        FROM house_user
        WHERE house_id = #{houseId} AND type = 1
        limit 1
    </select>


</mapper>